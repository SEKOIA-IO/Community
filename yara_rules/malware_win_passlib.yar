rule malware_win_passlib {
    meta:
        id = "609999e2-a644-4bf3-bce2-b0e1b0e7094b"
        version = "1.0"
        description = "Detect the Passlib malware"
        author = "Sekoia.io"
        creation_date = "2022-07-28"
        classification = "TLP:CLEAR"
        
    strings:
        $ = "Passlib test utility - Version %s" wide
        $ = "-l <full_path_to_dll_to_load_into_lsass> (arbitrary dll injection into LSASS)" wide
        $ = "-u <dll_to_unload_from_lsass> (arbitrary dll uninjection from LSASS)" wide
        $ = "DLL %s injection was successful requested!" wide
        $ = "DLL %s uninjection was successful requested!" wide
        $ = "Process %s was succesfully created with full privileges and system integrity!" wide
        $ = "full_path_to_volatile_payload_dll" wide
        $ = "%s: [%s]:[%s] (http_only:%d)" wide
        $ = "LEX server has been deployed at lsass." wide
        $ = "LEX client is using volatile payload at: %s" wide
        $ = "LEX client is using permanent payload at: %s" wide
        $ = "Passlib execution finished" wide
        $ = "Running on Passlib version %ws" wide
        $ = "There was a problem initializing passlib manager interface." wide
        $ = "Passlib running without high integrity" wide
        $ = "About to dump passwords through passlib manager interface" wide
        
    condition:
        uint16(0)==0x5A4D
        and filesize > 1500KB
        and all of them
}
        