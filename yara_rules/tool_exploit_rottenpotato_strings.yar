rule tool_exploit_rottenpotato_strings {
    meta:
        id = "453646d4-b128-40ea-8840-4c53b8f1e486"
        version = "1.0"
        description = "Detects RottenPotato compiled binaries"
        author = "Sekoia.io"
        creation_date = "2022-09-09"
        classification = "TLP:CLEAR"
        
    strings:
        $ = "WSAStartup failed with error: %d"
        $ = "getaddrinfo failed with error: %d"
        $ = "RPC -> send failed with error: %d"
        $ = "RPC-> Connection closed"
        $ = "COM -> bytes sent: %d"
        $ = "COM -> recv failed with error: %d"
        $ = "Running %S with args %S"
        $ = "[-] Failed to create proc: %d"
        $ = "Waiting for auth..."
        $ = "Auth result: %d"
        $ = "SeImpersonatePrivilege" wide
        
    condition:
        uint16be(0) == 0x4d5a and
        filesize < 1MB and
        8 of them
}
        