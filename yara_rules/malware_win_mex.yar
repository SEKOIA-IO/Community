rule malware_win_mex {
    meta:
        id = "57fe8525-4bab-4078-ac6f-635f0f7963ec"
        version = "1.0"
        description = "Detect the MEX malware"
        author = "Sekoia.io"
        creation_date = "2022-07-28"
        classification = "TLP:CLEAR"
        
    strings:
        $ = "MEX: In-memory execution of offensive tradecraft (Version:" wide
        $ = "Available Options:" wide
        $ = "-meh <help>" wide
        $ = "-mep <payload_name_to_use>" wide
        $ = "-mec <payload_args>" wide
        $ = "Execution examples:" wide
        $ = "mex.exe -mep sharphound" wide
        $ = "mex.exe -mep sharphound -mec -arg1" wide
        $ = "mex.exe -mep get_version" wide
        $ = "mex.exe -mep list_plugins" wide
        $ = "Available plugins:" wide
        $ = "Payload to execute:" wide
        $ = "No payload arguments were provided" wide
        $ = "Payload arguments:" wide
        $ = "MEX - About to execute payload %s with command line arguments: %s" wide
        $ = "MEX - About to execute payload %s with no command line arguments" wide
        $ = "Execution of payload %s just finished. Quitting now." wide
        $ = "There was a problem executing payload %s. Quitting now." wide
        $ = "chisel" wide
        $ = "enum_script" wide
        $ = "eop_script" wide
        $ = "mexecatz" wide
        $ = "scshell" wide
        $ = "shares_script" wide
        $ = "internalmonologue" wide
        $ = "inveigh" wide
        $ = "pingcastle" wide
        $ = "rubeus" wide
        $ = "seatbelt" wide
        $ = "sharpexec" wide
        $ = "sharphound3" wide
        $ = "spoolsample" wide
        $ = "standin" wide
        $ = "grouper2" wide
        $ = "lockless" wide
        $ = "sharpoxidresolver" wide
        $ = "sharpprinter" wide
        $ = "list_plugins" wide
        $ = "get_version" wide
        $ = "Current version is %s" wide
        $ = "Supported plugins:" wide
        
    condition:
        uint16(0)==0x5A4D
        and filesize > 10MB
        and 15 of them
}
        