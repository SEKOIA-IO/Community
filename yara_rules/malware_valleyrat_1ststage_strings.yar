rule malware_valleyrat_1ststage_strings {
    meta:
        id = "6628ba47-37ad-4bdb-bbc0-7286d777000e"
        version = "1.0"
        description = "Detects ValleyRat 1stage"
        author = "Sekoia.io"
        creation_date = "2024-06-11"
        classification = "TLP:CLEAR"
        
    strings:
        $ = "%016llX.DLL" wide
        $ = "%s\\%s" wide
        $ = "%016llX\\%s" wide
        $ = "connection already in progress"
        $ = "SleepConditionVariableSRW"
        
    condition:
        uint16be(0) == 0x4d5a and
        filesize < 4MB and
        all of them
}
        