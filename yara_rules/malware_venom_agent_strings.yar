rule malware_venom_agent_strings {
    meta:
        id = "87633510-8b39-4eb1-b95b-4ebff21f3bba"
        version = "1.0"
        description = "Detects Venom agent strings"
        author = "Sekoia.io"
        creation_date = "2022-08-29"
        classification = "TLP:CLEAR"
        
    strings:
        $ = "dispather.handleDownloadCmd"
        $ = "dispather.handleUploadCmd"
        $ = "dispather.handleShellCmd"
        $ = "dispather.handleSocks5Cmd"
        $ = "dispather.handleLForwardCmd"
        $ = "dispather.localLForwardServer"
        $ = "dispather.handleRForwardCmd"
        $ = "dispather.AgentHandShake"
        $ = "dispather.AgentParseTarget"
        $ = "dispather.PipeWhenClose"
        $ = "dispather.handleSshConnectCmd"
        $ = "node.(*NetworkTopology).InitNetworkMap"
        $ = "node.CopyNet2Node"
        $ = "node.(*Node).CommandHandler.func1"
        $ = "node.(*Buffer).WriteLowLevelPacket"
        $ = "protocol.(*Packet).ResolveDat"
        $ = "netio.InitTCP.func2"
        
    condition:
        (uint32be(0) == 0x7f454c46 or uint16be(0) == 0x4d5a) and filesize < 10MB and 6 of them
}
        