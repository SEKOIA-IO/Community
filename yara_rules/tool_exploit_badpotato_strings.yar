rule tool_exploit_badpotato_strings {
    meta:
        id = "079aabbc-6978-4d71-92d2-d2a7ce1cc915"
        version = "1.0"
        description = "Detects BadPotato compiled exploit"
        author = "Sekoia.io"
        creation_date = "2022-09-09"
        classification = "TLP:CLEAR"
        
    strings:
        $ = "RpcStringBindingCompose failed with status 0x" wide
        $ = "RpcBindingFromStringBinding failed with status 0x" wide
        $ = "RpcBindingSetAuthInfoEx failed with status 0x" wide
        $ = "RpcBindingSetOption failed with status 0x" wide
        $ = "\\\\.\\pipe\\{0}\\pipe\\spoolss" wide
        $ = "[*] {0} Success! ProcessPid:{1}" wide
        
    condition:
        uint16be(0) == 0x4d5a and
        filesize < 1MB and
        5 of them
}
        