rule tool_juicypotato_exploit_strings {
    meta:
        id = "03d697ae-69a7-490b-8b3c-9a8c21fb46a2"
        version = "1.0"
        description = "Detects the JuicyPotato exploit based on strings"
        author = "Sekoia.io"
        creation_date = "2022-09-09"
        classification = "TLP:CLEAR"
        
    strings:
        $ = "JuicyPotato v%s"
        $ = "-t createprocess call: <t> CreateProcessWithTokenW"
        $ = "-p <program>: program to launch"
        $ = "-l <port>: COM server listen port"
        $ = "-m <ip>: COM server listen address"
        $ = "-n <port>: RPC server listen port"
        $ = "Error - Unknown NTLM message type..."
        $ = "[+] authresult %d"
        $ = "Waiting for auth..."
        
    condition:
        uint16be(0) == 0x4d5a and
        filesize < 500KB and
        2 of them
}
        